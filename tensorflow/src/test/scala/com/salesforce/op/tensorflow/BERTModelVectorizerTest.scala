/*
 * Copyright (c) 2017, Salesforce.com, Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 *
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 *
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

package com.salesforce.op.tensorflow

import com.salesforce.op.features.types._
import com.salesforce.op.test.{OpTransformerSpec, TestFeatureBuilder}
import org.apache.spark.ml.linalg.Vectors
import org.junit.runner.RunWith
import org.scalatest.junit.JUnitRunner


@RunWith(classOf[JUnitRunner])
class BERTModelVectorizerTest extends OpTransformerSpec[OPVector, BERTModelVectorizer] {

  lazy val (inputData, f1) = TestFeatureBuilder(Seq(
    "I like apples".toText,
    "But what about beer?".toText,
    "Beer is fine... But cider is probably better. Let's go get some!".toText,
    Text.empty
  ))

  lazy val bertModelResource = "com/robrua/nlp/easy-bert/bert-uncased-L-12-H-768-A-12"

  lazy val bertLoader = new BERTModelResourceLoader(bertModelResource)

  lazy val transformer = new BERTModelVectorizer(bertLoader).setInput(f1)

  // scalastyle:off
  val expectedResult: Seq[OPVector] = Seq(
    OPVector(Vectors.dense(Array(-0.8648539185523987, -0.29226115345954895, 0.08932681381702423, 0.6614484786987305, 0.11151047050952911, -0.11952368915081024, 0.8588595390319824, 0.1774512231349945, 0.07965116947889328, -0.9998978972434998, -0.01874241977930069, 0.48769307136535645, 0.9853988289833069, -0.10100051760673523, 0.9331648945808411, -0.5660421252250671, -0.026766888797283173, -0.5928214192390442, 0.28738683462142944, -0.6527099609375, 0.6217289566993713, 0.9722893834114075, 0.3701774477958679, 0.2757438123226166, 0.3983032703399658, 0.6480932831764221, -0.5917239189147949, 0.9248282313346863, 0.9489416480064392, 0.723774254322052, -0.5882499814033508, 0.1571078896522522, -0.9893736243247986, -0.13182440400123596, 0.06621646881103516, -0.9900329113006592, 0.2737494707107544, -0.7539511322975159, 0.021929554641246796, 0.10461747646331787, -0.8994688391685486, 0.27871641516685486, 0.9989166855812073, -0.08512485772371292, 0.10673878341913223, -0.23603448271751404, -0.999958336353302, 0.20935527980327606, -0.8823558688163757, -0.05457477644085884, 0.11267873644828796, -0.30444374680519104, 0.0812297984957695, 0.3653534948825836, 0.3881835341453552, 0.24352717399597168, -0.1604180932044983, 0.08135688304901123, -0.1845809370279312, -0.5421218872070312, -0.607766330242157, 0.3128068745136261, -0.296522319316864, -0.875991940498352, -0.045561984181404114, -0.3406555652618408, -0.09181848168373108, -0.19980546832084656, 0.05067242309451103, -0.10233236104249954, 0.7908505201339722, 0.13067828118801117, 0.3311536908149719, -0.794165849685669, -0.35627591609954834, 0.14775803685188293, -0.5541237592697144, 0.9999998807907104, -0.24338532984256744, -0.9834551215171814, -0.117997907102108, -0.20246419310569763, 0.4229506850242615, 0.4541281759738922, -0.5032221674919128, -0.9999980330467224, 0.35770633816719055, -0.09281574189662933, -0.9914031624794006, 0.21651829779148102, 0.3910459876060486, -0.14415717124938965, -0.37974557280540466, 0.48743852972984314, -0.20209923386573792, -0.20112738013267517, -0.20106202363967896, -0.12219485640525818, -0.09801915287971497, -0.09681028127670288, 0.0024862531572580338, -0.09329278767108917, -0.060471490025520325, -0.27281370759010315, 0.16500622034072876, -0.3869476318359375, -0.4681839346885681, 0.03484749421477318, -0.13939563930034637, 0.6438435316085815, 0.3263972997665405, -0.2619861960411072, 0.34782326221466064, -0.9519293308258057, 0.5753459334373474, -0.24224670231342316, -0.982029378414154, -0.5015093088150024, -0.9911015033721924, 0.6744064092636108, -0.008732354268431664, -0.21969129145145416, 0.9565872550010681, 0.5244384407997131, 0.2530193626880646, -0.03151828795671463, 0.23857897520065308, -1.0, -0.3711744546890259, -0.201841801404953, 0.3294467031955719, -0.07990316301584244, -0.980018138885498, -0.9564015865325928, 0.5544179081916809, 0.9391964077949524, 0.0600004568696022, 0.9983959197998047, -0.18440786004066467, 0.9354084730148315, 0.183447003364563, -0.09992704540491104, -0.11805463582277298, -0.3777066767215729, 0.33195823431015015, 0.16721785068511963, -0.6240189671516418, 0.2251070737838745, 0.04300086572766304, 0.04131679981946945, -0.12397480756044388, -0.2075175940990448, 0.10284918546676636, -0.932129442691803, -0.3481193482875824, 0.9391725063323975, 0.16176679730415344, 0.05155115947127342, 0.6386932730674744, -0.17599038779735565, -0.3836769163608551, 0.8364430665969849, 0.20621724426746368, 0.2788241505622864, -0.1449485868215561, 0.3089696764945984, -0.3229634463787079, 0.4463197588920593, -0.7950357794761658, 0.2772024869918823, 0.33407270908355713, -0.17295889556407928, 0.06623636931180954, -0.9825852513313293, -0.28403452038764954, 0.40205463767051697, 0.9885663390159607, 0.6893802881240845, 0.18637144565582275, 0.18729163706302643, -0.2003936618566513, 0.4756831228733063, -0.945289134979248, 0.981971263885498, -0.15332765877246857, 0.28293871879577637, 0.29969462752342224, -0.31323322653770447, -0.841689944267273, -0.15761665999889374, 0.7281718850135803, -0.44652634859085083, -0.8351826667785645, 0.0026928342413157225, -0.4130500257015228, -0.3502292335033417, -0.15636086463928223, 0.3764285743236542, -0.25420212745666504, -0.387991726398468, -0.02637447789311409, 0.923821747303009, 0.9364331364631653, 0.7788233160972595, -0.48832109570503235, 0.5188876390457153, -0.9146115183830261, -0.486280620098114, 0.08095545321702957, 0.14383623003959656, 0.1182607039809227, 0.9934242367744446, -0.11585714668035507, -0.11186864972114563, -0.922224760055542, -0.983223557472229, -0.03475838899612427, -0.896352231502533, -0.0639435350894928, -0.5217722654342651, 0.3312220871448517, 0.5197339057922363, -0.13492043316364288, 0.3943636417388916, -0.9740439057350159, -0.7586069107055664, 0.36445218324661255, -0.23579718172550201, 0.3213900625705719, -0.27269190549850464, 0.7048781514167786, 0.16910120844841003, -0.5287593007087708, 0.7304396629333496, 0.8739982843399048, 0.25889888405799866, -0.6445761919021606, 0.7714097499847412, -0.21305759251117706, 0.8151193857192993, -0.5786250829696655, 0.9788151979446411, 0.22055384516716003, 0.5193850994110107, -0.9378955960273743, 0.195521280169487, -0.867616593837738, 0.07414530217647552, -0.09482479095458984, -0.6226586103439331, 0.07164085656404495, 0.5128912329673767, 0.3091566562652588, 0.7980011105537415, -0.4742039740085602, 0.9895601868629456, -0.7348896265029907, -0.9607440829277039, -0.1124722883105278, -0.11824383586645126, -0.9898037910461426, 0.11947550624608994, 0.31688839197158813, -0.391012579202652, -0.35387060046195984, -0.30495205521583557, -0.963628351688385, 0.8068814277648926, 0.11037974059581757, 0.9741523265838623, 0.03831057995557785, -0.8853883147239685, -0.34509289264678955, -0.9264061450958252, -0.10222196578979492, -0.02019468881189823, 0.5152854919433594, -0.2053646445274353, -0.9623973965644836, 0.4453069865703583, 0.5670123100280762, 0.3814874589443207, 0.42584601044654846, 0.993286669254303, 0.999727189540863, 0.9784783720970154, 0.8624532222747803, 0.7981200218200684, -0.9454193711280823, -0.21135470271110535, 0.9999426603317261, -0.7298356890678406, -0.9999924898147583, -0.9332638382911682, -0.588699221611023, 0.28337153792381287, -0.9999999403953552, -0.0503578819334507, 0.04782275855541229, -0.9337707161903381, -0.21891236305236816, 0.9761088490486145, 0.9797694087028503, -0.9999998807907104, 0.8379399180412292, 0.9287773370742798, -0.558226466178894, 0.53206467628479, -0.21118134260177612, 0.9725586771965027, 0.29092708230018616, 0.5413376092910767, 0.013339514844119549, 0.32217690348625183, -0.31015732884407043, -0.803774893283844, 0.3583129644393921, 0.11386744678020477, 0.6579538583755493, 0.14848989248275757, -0.6303977370262146, -0.9178988933563232, 0.08575116097927094, -0.1461314707994461, -0.2088903784751892, -0.9632179141044617, -0.16696032881736755, -0.20954416692256927, 0.665062427520752, 0.08255879580974579, 0.1577027440071106, -0.7507617473602295, 0.2096717804670334, -0.6770409941673279, 0.3138412833213806, 0.5912479162216187, -0.9166365265846252, -0.5591286420822144, -0.06564580649137497, -0.43842798471450806, 0.21896500885486603, -0.945311427116394, 0.9685778021812439, -0.23258556425571442, 0.07990208268165588, 0.9999998807907104, 0.026372652500867844, -0.8743310570716858, 0.2794642746448517, 0.15860672295093536, -0.17162948846817017, 0.9999993443489075, 0.5123187303543091, -0.9829139113426208, -0.43246379494667053, 0.19979716837406158, -0.3819575309753418, -0.41036269068717957, 0.998376727104187, -0.2440042793750763, 0.22888673841953278, 0.25509169697761536, 0.9836746454238892, -0.9922938346862793, 0.5740655064582825, -0.8919732570648193, -0.9665190577507019, 0.9609911441802979, 0.9478117227554321, -0.31309327483177185, -0.5739044547080994, 0.009185533039271832, 0.10650914162397385, 0.2236264944076538, -0.9365957379341125, 0.5278977751731873, 0.45375022292137146, -0.0795166864991188, 0.9115439057350159, -0.7667385339736938, -0.45808136463165283, 0.311917781829834, 0.097286656498909, 0.43369561433792114, 0.07268476486206055, 0.40457117557525635, -0.1518002152442932, -0.04640354588627815, -0.28244122862815857, -0.4546702802181244, -0.959378182888031, -0.0029203889425843954, 0.9999993443489075, 0.07363731414079666, -0.13697044551372528, -0.13829782605171204, -0.0044698393903672695, -0.27644768357276917, 0.3829220235347748, 0.3646719455718994, -0.284297376871109, -0.7770472168922424, 0.07228346914052963, -0.8857768177986145, -0.9896013140678406, 0.6927331686019897, 0.18245984613895416, -0.24463725090026855, 0.9992983937263489, 0.24304285645484924, 0.17732886970043182, -0.10205889493227005, 0.4589557349681854, -0.1635168343782425, 0.4493371844291687, -0.3055773973464966, 0.9743691086769104, -0.2814004421234131, 0.4692825973033905, 0.7813810110092163, -0.0780021920800209, -0.3181633949279785, -0.5933877825737, 0.04830749332904816, -0.9188334941864014, 0.09723179787397385, -0.9521693587303162, 0.9567217230796814, -0.09996360540390015, 0.26644572615623474, 0.08439326286315918, -0.02032558061182499, 0.9999998807907104, -0.4003079831600189, 0.5342525243759155, -0.34713536500930786, 0.7835818529129028, -0.9121533632278442, -0.679269015789032, -0.33406203985214233, -0.01095476746559143, 0.12094604969024658, -0.2617250382900238, 0.20264700055122375, -0.9678882360458374, -0.15386967360973358, 0.0338306725025177, -0.9654868841171265, -0.9922358393669128, 0.3403875231742859, 0.5902285575866699, 0.11666510999202728, -0.5213509798049927, -0.6624228358268738, -0.5596274733543396, 0.39425989985466003, -0.1802932322025299, -0.944688081741333, 0.5654410123825073, -0.1598191112279892, 0.3497700095176697, -0.14530009031295776, 0.49609312415122986, -0.24251890182495117, 0.8133797645568848, 0.48036471009254456, 0.1064901277422905, 0.009404286742210388, -0.7655702233314514, 0.7684870362281799, -0.7262482047080994, -0.06251876801252365, -0.11241461336612701, 0.9999998807907104, -0.23630590736865997, 0.10078463703393936, 0.6864333748817444, 0.6408790946006775, -0.09268952906131744, 0.24917688965797424, -0.041750334203243256, 0.22542354464530945, 0.1990824043750763, 0.3420284688472748, -0.4923897087574005, -0.26883465051651, 0.4472927153110504, -0.24748846888542175, -0.4031735956668854, 0.7999324798583984, 0.13233932852745056, 0.09463469684123993, 0.08692702651023865, -0.04464862123131752, 0.9973556399345398, -0.16857647895812988, -0.10150220990180969, -0.33978188037872314, -0.08523692190647125, -0.24405249953269958, -0.3214559853076935, 0.9999967813491821, 0.2775457501411438, -0.0848560556769371, -0.9924013614654541, -0.008656099438667297, -0.8721670508384705, 0.9987680315971375, 0.8092157244682312, -0.8047909140586853, 0.48472848534584045, 0.4732349216938019, -0.07761849462985992, 0.6922585964202881, -0.13605022430419922, -0.13628670573234558, 0.14633961021900177, 0.1406034380197525, 0.9651384949684143, -0.3874143362045288, -0.9739566445350647, -0.4639500081539154, 0.2840106785297394, -0.9649752378463745, 0.9495785236358643, -0.4481785297393799, -0.12529994547367096, -0.2769620716571808, 0.1654590666294098, 0.47481435537338257, -0.05316981300711632, -0.979817271232605, -0.18465633690357208, 0.06621628999710083, 0.9673378467559814, 0.16568778455257416, -0.4707387089729309, -0.9038993120193481, -0.36401432752609253, 0.18571050465106964, 0.060380719602108, -0.9322501420974731, 0.9737595915794373, -0.9745174646377563, 0.49566537141799927, 0.9999919533729553, 0.21854358911514282, -0.6075478792190552, 0.17289386689662933, -0.3415412902832031, 0.20740211009979248, -0.11882072687149048, 0.4478381872177124, -0.9484656453132629, -0.2354341447353363, -0.08151186257600784, 0.13193942606449127, -0.10870124399662018, 0.20170216262340546, 0.6466891169548035, 0.19403572380542755, -0.49784785509109497, -0.49469664692878723, -0.05850180983543396, 0.323673278093338, 0.7078132033348083, -0.2239023894071579, -0.060338620096445084, 0.03354593366384506, -0.11290708929300308, -0.9366562366485596, -0.2151147574186325, -0.28688719868659973, -0.9906469583511353, 0.5254970192909241, -0.9999998807907104, -0.25982722640037537, -0.5778210163116455, -0.18291068077087402, 0.8248745799064636, 0.08343171328306198, -0.1875850111246109, -0.752901554107666, 0.20216432213783264, 0.7956030368804932, 0.7469912767410278, -0.17565859854221344, 0.13440191745758057, -0.7551529407501221, 0.20082879066467285, -0.044485364109277725, 0.2066456377506256, 0.21751628816127777, 0.6412163376808167, -0.19777630269527435, 0.9999999403953552, 0.029818901792168617, -0.36430972814559937, -0.9594900608062744, 0.20143546164035797, -0.22531771659851074, 0.9998940825462341, -0.8225052356719971, -0.9551668763160706, 0.2906406819820404, -0.33383509516716003, -0.7911277413368225, 0.18755310773849487, -0.04271838441491127, -0.6424609422683716, -0.2696097195148468, 0.9340456128120422, 0.7566158175468445, -0.4644737243652344, 0.4152832329273224, -0.25912293791770935, -0.42767056822776794, -0.02391981892287731, -0.13327620923519135, 0.9880465865135193, 0.2889367341995239, 0.8665672540664673, 0.5246783494949341, -0.011107889004051685, 0.9669353365898132, 0.14773422479629517, 0.5199957489967346, 0.09875789284706116, 0.9999967217445374, 0.2919812798500061, -0.9062055945396423, 0.14939875900745392, -0.9841769337654114, -0.18601341545581818, -0.9434442520141602, 0.2081962674856186, 0.06666172295808792, 0.861688494682312, -0.1778692603111267, 0.9651776552200317, 0.2835792005062103, 0.029094628989696503, 0.002807553857564926, 0.40674889087677, 0.3411606550216675, -0.9262142777442932, -0.9871047139167786, -0.9881176352500916, 0.2180042266845703, -0.44125989079475403, 0.011112234555184841, 0.2539993226528168, 0.06324534863233566, 0.334329217672348, 0.32784268260002136, -0.9999939799308777, 0.9293665885925293, 0.38100454211235046, -0.14237864315509796, 0.9720848798751831, 0.3018098473548889, 0.2663033604621887, 0.21215474605560303, -0.9874882698059082, -0.9343121647834778, -0.30340418219566345, -0.20359113812446594, 0.7381657958030701, 0.49231716990470886, 0.8411647081375122, 0.34775298833847046, -0.4802994728088379, -0.12247657775878906, 0.26940223574638367, -0.5846818089485168, -0.9936667084693909, 0.3922731876373291, 0.30014705657958984, -0.9332719445228577, 0.9530529379844666, -0.6243503093719482, -0.1612364500761032, 0.5433086156845093, -0.009109235368669033, 0.8876913785934448, 0.6788612604141235, 0.4142081141471863, 0.11238615959882736, 0.5061672925949097, 0.8920465707778931, 0.9105831384658813, 0.987479031085968, -0.01558024063706398, 0.6262851357460022, 0.18518799543380737, 0.32894495129585266, 0.7229142189025879, -0.9310141205787659, 0.1210700049996376, -0.05466379597783089, -0.23676343262195587, 0.2762313485145569, -0.20866946876049042, -0.9331138134002686, 0.5431385040283203, -0.2451755255460739, 0.4864426553249359, -0.3633687198162079, 0.2060278207063675, -0.37253808975219727, -0.19504225254058838, -0.6269807815551758, -0.2908017337322235, 0.558683454990387, 0.30610355734825134, 0.9316391944885254, 0.37258169054985046, -0.02336122654378414, -0.568047821521759, -0.11418595165014267, 0.2708493769168854, -0.9276042580604553, 0.8711143732070923, -0.04937130957841873, 0.4789307713508606, -0.15233656764030457, 0.005970628000795841, 0.7338551878929138, -0.21847128868103027, -0.2923014760017395, -0.20566876232624054, -0.6821643710136414, 0.8179224729537964, -0.30094626545906067, -0.4368616044521332, -0.4672141373157501, 0.7173956036567688, 0.30553102493286133, 0.983931839466095, -0.0019859569147229195, -0.190289705991745, -0.1650172770023346, -0.16320426762104034, 0.3237666189670563, -0.3192746043205261, -0.9999945759773254, 0.31705692410469055, 0.1924852728843689, 0.0061093284748494625, -0.26260906457901, 0.06474992632865906, -0.017984025180339813, -0.9687986373901367, -0.26327770948410034, 0.046963583678007126, -0.17801134288311005, -0.44590330123901367, -0.4997160732746124, 0.4946833550930023, 0.3600103557109833, 0.4928617477416992, 0.8563328981399536, 0.24358922243118286, 0.6159642338752747, 0.5814067721366882, 0.13024525344371796, -0.6259509325027466, 0.9114722609519958))),
    OPVector(Vectors.dense(Array(-0.9169268012046814, -0.3846336007118225, -0.9155148863792419, 0.8250617384910583, 0.5750892758369446, -0.19119951128959656, 0.9546128511428833, 0.41493964195251465, -0.7310819029808044, -0.9999920725822449, -0.5368106961250305, 0.9246413111686707, 0.9800028800964355, 0.548424482345581, 0.9461490511894226, -0.7976499199867249, -0.5025057196617126, -0.7087666988372803, 0.3149501383304596, -0.7616304755210876, 0.7306570410728455, 0.9999644756317139, -0.08569119870662689, 0.4063286781311035, 0.5028427243232727, 0.9658555388450623, -0.807009220123291, 0.9432225823402405, 0.9599157571792603, 0.7276307344436646, -0.731304407119751, 0.31031543016433716, -0.9814265370368958, -0.14595647156238556, -0.7827618718147278, -0.9926375150680542, 0.4449692964553833, -0.7760291695594788, 0.04411255568265915, -0.1201680451631546, -0.9025093913078308, 0.308106392621994, 0.999962329864502, -0.46437057852745056, 0.5042518377304077, -0.391025573015213, -1.0, 0.2891470193862915, -0.9144779443740845, 0.8453624844551086, 0.8601322770118713, 0.7269293665885925, 0.26446861028671265, 0.580790102481842, 0.565142810344696, -0.05882387235760689, -0.08922355622053146, 0.16586492955684662, -0.23485922813415527, -0.6747933030128479, -0.6795089244842529, 0.4453413784503937, -0.8384408354759216, -0.9227985143661499, 0.9000692367553711, 0.7521404027938843, -0.1799389123916626, -0.41578012704849243, -0.21911104023456573, 0.1215878501534462, 0.9428570866584778, 0.14640146493911743, -0.17552892863750458, -0.8663308620452881, 0.6434048414230347, 0.26477906107902527, -0.7212527990341187, 1.0, -0.6289777755737305, -0.9753720164299011, 0.7244689464569092, 0.831762433052063, 0.6717208623886108, -0.4021484851837158, 0.5030544400215149, -1.0, 0.6137887835502625, -0.15618352591991425, -0.9887030124664307, 0.32866019010543823, 0.542750358581543, -0.2902170717716217, 0.5465874671936035, 0.6252856254577637, -0.729691207408905, -0.47307249903678894, -0.3310770094394684, -0.7971211075782776, -0.16646049916744232, -0.39876028895378113, 0.038539987057447433, -0.25449568033218384, -0.3686928451061249, -0.38269540667533875, 0.35752612352371216, -0.6194747090339661, -0.7015655040740967, 0.6497598886489868, 0.28862136602401733, 0.7168877720832825, 0.5005384683609009, -0.33044981956481934, 0.5245750546455383, -0.9530192613601685, 0.717471182346344, -0.4650346636772156, -0.9867674708366394, -0.6914814114570618, -0.9890903234481812, 0.6750051379203796, -0.49006175994873047, -0.294573038816452, 0.9601135849952698, -0.12987089157104492, 0.5096179842948914, -0.21615542471408844, -0.8242343068122864, -1.0, -0.7751719355583191, -0.605660617351532, -0.2761767506599426, -0.4127552807331085, -0.9723411202430725, -0.9576354622840881, 0.7026721835136414, 0.9692339301109314, 0.3196440637111664, 0.9998946189880371, -0.31842178106307983, 0.936968982219696, -0.2767565846443176, -0.6093980669975281, 0.5063678026199341, -0.5651441812515259, 0.7708329558372498, 0.5644938945770264, -0.6881769895553589, 0.33383744955062866, -0.4323403537273407, 0.23252418637275696, -0.8155465722084045, -0.2859409749507904, -0.787988007068634, -0.9421844482421875, -0.4158405661582947, 0.9508123993873596, -0.3621625602245331, -0.905154824256897, -0.1348802000284195, -0.3329521715641022, -0.5972527861595154, 0.8648272156715393, 0.7495154738426208, 0.49858254194259644, -0.501187264919281, 0.508297324180603, 0.5282812714576721, 0.5504769682884216, -0.889784038066864, 0.0465245395898819, 0.5272154211997986, -0.3868523836135864, -0.8302684426307678, -0.9735226035118103, -0.4405580461025238, 0.5745660066604614, 0.9877862930297852, 0.829743504524231, 0.38071098923683167, 0.7523713111877441, -0.4291693866252899, 0.6045125722885132, -0.9397719502449036, 0.9769036173820496, -0.13818004727363586, 0.24269337952136993, 0.04953456670045853, 0.2092931568622589, -0.8960118889808655, -0.05514760687947273, 0.9089655876159668, -0.5726907849311829, -0.8151711821556091, -0.14466141164302826, -0.5161387920379639, -0.5345435738563538, -0.6772753596305847, 0.6463242769241333, -0.33375564217567444, -0.4259747564792633, -0.11837173998355865, 0.9362521171569824, 0.9886572957038879, 0.8442200422286987, 0.13099579513072968, 0.7535912990570068, -0.9160230755805969, -0.5708276033401489, 0.1525169312953949, 0.2834223210811615, 0.06317103654146194, 0.99360591173172, -0.574317216873169, -0.2054753601551056, -0.9219609498977661, -0.9783232808113098, 0.0766015499830246, -0.915209949016571, -0.31535953283309937, -0.6912631988525391, 0.678439199924469, 0.25807151198387146, 0.6220442056655884, 0.4857200086116791, -0.9866893291473389, -0.8123714327812195, 0.4695679247379303, -0.4908488094806671, 0.45145970582962036, -0.2603350877761841, 0.5874196887016296, 0.8989631533622742, -0.7133958339691162, 0.820442259311676, 0.906438410282135, -0.8330224752426147, -0.7230904698371887, 0.8721898198127747, -0.36246660351753235, 0.8927474021911621, -0.68023282289505, 0.990404486656189, 0.8790799975395203, 0.7884872555732727, -0.9155920743942261, -0.6634724736213684, -0.9179392457008362, -0.7659154534339905, -0.018862063065171242, 0.19092579185962677, 0.8994324207305908, 0.701604962348938, 0.3646216094493866, 0.2150614708662033, -0.6710497140884399, 0.9988420605659485, -0.642200231552124, -0.9519422054290771, -0.3059209883213043, -0.3425105810165405, -0.9838835000991821, 0.8603629469871521, 0.44314470887184143, 0.060013432055711746, -0.5484952330589294, -0.783234179019928, -0.9591760039329529, 0.901462972164154, 0.25690069794654846, 0.993749737739563, -0.2090943455696106, -0.962340235710144, -0.6246705055236816, -0.8984560370445251, -0.1105143278837204, -0.21352799236774445, -0.3573024272918701, -0.09310057014226913, -0.9681453108787537, 0.6112047433853149, 0.6867542266845703, 0.5926146507263184, -0.8186250925064087, 0.9994392395019531, 0.9999999403953552, 0.9703409671783447, 0.9165119528770447, 0.9031810760498047, -0.9997887015342712, -0.3805265724658966, 0.9999977350234985, -0.9801552891731262, -1.0, -0.9530657529830933, -0.6711206436157227, 0.5159555673599243, -1.0, -0.33223989605903625, -0.04252803325653076, -0.9026327133178711, 0.7141496539115906, 0.9725556969642639, 0.9963111877441406, -1.0, 0.8897644281387329, 0.955109179019928, -0.7231877446174622, 0.9173907041549683, -0.3114580512046814, 0.9654859900474548, 0.7034612894058228, 0.6401439905166626, -0.19642136991024017, 0.4239332377910614, -0.9304969310760498, -0.9001124501228333, -0.5907294154167175, -0.6461377739906311, 0.9947332739830017, 0.239609494805336, -0.8614954948425293, -0.9027438759803772, 0.48527464270591736, -0.23123909533023834, -0.19850392639636993, -0.9624040126800537, -0.23969416320323944, 0.5953124761581421, 0.8011112213134766, 0.22012721002101898, 0.38616031408309937, -0.7666766047477722, 0.31985121965408325, -0.021491514518857002, 0.4249874949455261, 0.7422927618026733, -0.9482060670852661, -0.6593934893608093, -0.3336065411567688, -0.11564891785383224, -0.6332911252975464, -0.9522401690483093, 0.9616047143936157, -0.4779122471809387, 0.821155846118927, 1.0, 0.3909260928630829, -0.883397102355957, 0.6480945348739624, 0.3796301782131195, -0.43667173385620117, 1.0, 0.7931771874427795, -0.9723942875862122, -0.620445191860199, 0.48585987091064453, -0.6629727482795715, -0.5946423411369324, 0.9995146989822388, -0.2504245638847351, -0.6904953718185425, -0.519125759601593, 0.9681034088134766, -0.9855117797851562, 0.9912289977073669, -0.9241109490394592, -0.9596906304359436, 0.975706934928894, 0.9298259019851685, -0.8267790079116821, -0.7075658440589905, 0.23793405294418335, -0.7270967960357666, 0.432477742433548, -0.9680010676383972, 0.8018097877502441, 0.6616170406341553, -0.131646990776062, 0.9071247577667236, -0.9172312617301941, -0.6065542697906494, 0.45463433861732483, -0.7985048890113831, -0.1694062352180481, 0.8721362948417664, 0.5851140022277832, -0.23798421025276184, 0.1058892011642456, -0.33705246448516846, -0.33656415343284607, -0.9804458618164062, 0.4313780963420868, 1.0, -0.21856600046157837, 0.6038209199905396, -0.6504485011100769, -0.06520015746355057, -0.1440112292766571, 0.6126670837402344, 0.5594577789306641, -0.38065841794013977, -0.8572809100151062, 0.5583677887916565, -0.9700472354888916, -0.9834842085838318, 0.8053464293479919, 0.28594836592674255, -0.3745957911014557, 0.9999978542327881, 0.5539315938949585, 0.20881299674510956, 0.21968461573123932, 0.9741401076316833, 0.08423741906881332, 0.6169619560241699, 0.8526025414466858, 0.98313969373703, -0.343530535697937, 0.6935443878173828, 0.9211507439613342, -0.911379873752594, -0.35012948513031006, -0.7065256237983704, 0.04714440926909447, -0.928780198097229, 0.0013031858252361417, -0.9588457345962524, 0.9642797112464905, 0.8895654082298279, 0.5064803957939148, 0.21591150760650635, 0.4373105466365814, 1.0, -0.62994384765625, 0.7266548871994019, -0.5167057514190674, 0.8546985983848572, -0.9994117021560669, -0.8916431665420532, -0.44754621386528015, -0.1780024617910385, -0.8299740552902222, -0.37695834040641785, 0.33523374795913696, -0.9747927188873291, 0.7316573262214661, 0.4705105125904083, -0.9908112287521362, -0.9889513850212097, -0.09500379115343094, 0.9022938013076782, 0.18503783643245697, -0.9758387804031372, -0.8119149804115295, -0.5861506462097168, 0.6845507621765137, -0.41955262422561646, -0.9472586512565613, -0.1876399666070938, -0.42993074655532837, 0.4750198721885681, -0.24542436003684998, 0.6605352759361267, 0.8003233671188354, 0.6396355628967285, -0.5470805764198303, -0.4018440246582031, -0.2412867248058319, -0.8675723075866699, 0.9047234058380127, -0.8778073191642761, -0.8141263127326965, -0.2748892903327942, 1.0, -0.570867121219635, 0.8837661743164062, 0.7804172039031982, 0.7670533061027527, -0.34323346614837646, 0.26929083466529846, 0.8779996037483215, 0.33772945404052734, -0.8287683725357056, -0.8070247173309326, -0.7818411588668823, -0.4821682572364807, 0.7403118014335632, 0.5525476336479187, 0.7445812821388245, 0.7630957961082458, 0.7136820554733276, 0.19864560663700104, -0.0997539758682251, 0.15823528170585632, 0.9998202323913574, -0.14847508072853088, -0.14035993814468384, -0.5803613066673279, 0.02424788847565651, -0.43729645013809204, -0.4303656816482544, 1.0, 0.3667643666267395, 0.4907194674015045, -0.9867616295814514, -0.7368266582489014, -0.9361682534217834, 0.9999995827674866, 0.8349626064300537, -0.847355842590332, 0.7217391133308411, 0.5881728529930115, -0.27926671504974365, 0.7725325226783752, -0.15719537436962128, -0.34051313996315, 0.2536456882953644, 0.2159319669008255, 0.944179356098175, -0.5939165949821472, -0.9715596437454224, -0.6780861616134644, 0.4908340871334076, -0.9662134647369385, 0.999801516532898, -0.6521108150482178, -0.2598686218261719, -0.44407737255096436, 0.026743868365883827, 0.5652957558631897, 0.07826528698205948, -0.9785097241401672, -0.33787116408348083, 0.1440708041191101, 0.9472562074661255, 0.2752508521080017, -0.6611968278884888, -0.9348200559616089, 0.6982990503311157, 0.7861539125442505, -0.8863030076026917, -0.9221899509429932, 0.9548962712287903, -0.9789198637008667, 0.5842674374580383, 1.0, 0.3866504728794098, -0.048224106431007385, 0.30345237255096436, -0.5178603529930115, 0.4800414741039276, -0.527915358543396, 0.8340973258018494, -0.9586024880409241, -0.35936254262924194, -0.18073107302188873, 0.3474378287792206, -0.180403932929039, -0.22374597191810608, 0.681205689907074, 0.1953965723514557, -0.642704963684082, -0.6439505219459534, -0.263425350189209, 0.5141094923019409, 0.8896974921226501, -0.3041488528251648, -0.26488974690437317, 0.3006550073623657, -0.16673709452152252, -0.9474601149559021, -0.4739204943180084, -0.488933801651001, -0.999985933303833, 0.7496944069862366, -1.0, 0.27102431654930115, 0.29258283972740173, -0.3239265978336334, 0.8834316730499268, 0.32237008213996887, 0.6148677468299866, -0.767127275466919, -0.8470956087112427, 0.3592567443847656, 0.8401174545288086, -0.26999273896217346, -0.3491288721561432, -0.7451475262641907, 0.3918314278125763, -0.06027291342616081, 0.1758899986743927, -0.31077879667282104, 0.8104705214500427, -0.32798564434051514, 1.0, 0.20022204518318176, -0.6466478109359741, -0.9856738448143005, 0.28279995918273926, -0.321882426738739, 1.0, -0.9568193554878235, -0.9399493336677551, 0.4225609302520752, -0.7657055854797363, -0.8479651808738708, 0.31654268503189087, 0.0876719132065773, -0.7474245429039001, -0.9010104537010193, 0.9677326679229736, 0.9443339705467224, -0.6342161297798157, 0.461220920085907, -0.4308503568172455, -0.6449331045150757, 0.0314098484814167, 0.7670219540596008, 0.9823197722434998, 0.6860564351081848, 0.932792067527771, 0.4756160378456116, -0.2025892734527588, 0.9702853560447693, 0.27081596851348877, 0.6453921794891357, 0.17639587819576263, 1.0, 0.4627987742424011, -0.9203106164932251, 0.03776611015200615, -0.9889125227928162, -0.2352079600095749, -0.9486539363861084, 0.40647608041763306, 0.23091360926628113, 0.859115481376648, -0.3090817630290985, 0.9597874879837036, -0.6293104290962219, 0.007887344807386398, -0.5089195966720581, -0.3721007704734802, 0.4375760555267334, -0.9425404667854309, -0.9829815030097961, -0.9826505780220032, 0.6590092182159424, -0.507860541343689, -0.21252146363258362, 0.3363758623600006, 0.19861675798892975, 0.5264639854431152, 0.49962118268013, -1.0, 0.9320873618125916, 0.4704638421535492, 0.8732231855392456, 0.9520319700241089, 0.7482775449752808, 0.5536289215087891, 0.3112788796424866, -0.9862659573554993, -0.9871214032173157, -0.3660297393798828, -0.30504244565963745, 0.7892261147499084, 0.6718044281005859, 0.8972302675247192, 0.4783446192741394, -0.562900960445404, -0.4588780999183655, -0.5651305317878723, -0.5009077191352844, -0.9920429587364197, 0.53994220495224, -0.5879510641098022, -0.9625809788703918, 0.9545287489891052, 0.017728127539157867, -0.2153407335281372, -0.13707555830478668, -0.7638717293739319, 0.9630681872367859, 0.7886354327201843, 0.4841044545173645, 0.21578507125377655, 0.5137472152709961, 0.9196906685829163, 0.9558892250061035, 0.9783565402030945, -0.7998378276824951, 0.8635998368263245, -0.48312443494796753, 0.5500708818435669, 0.8061249852180481, -0.9257268309593201, 0.21113449335098267, 0.3236444890499115, -0.5402374267578125, 0.29085925221443176, -0.28599053621292114, -0.9815932512283325, 0.8130480051040649, -0.34755179286003113, 0.6629881262779236, -0.4076746702194214, 0.0513673797249794, -0.44252657890319824, -0.31979310512542725, -0.7585874795913696, -0.650418221950531, 0.7250651121139526, 0.4963730573654175, 0.9298123717308044, 0.6955737471580505, -0.027916250750422478, -0.7562285661697388, -0.22400397062301636, -0.8007954955101013, -0.9102765321731567, 0.9641596674919128, -0.18502584099769592, -0.4479108452796936, 0.5761436820030212, -0.056898996233940125, 0.8427056670188904, 0.31707268953323364, -0.42644575238227844, -0.3645328879356384, -0.8104703426361084, 0.8943761587142944, -0.6112455725669861, -0.558308482170105, -0.632207453250885, 0.7358914613723755, 0.4309856593608856, 0.9999775290489197, -0.7673435211181641, -0.9072170257568359, -0.46899011731147766, -0.378296434879303, 0.4808388650417328, -0.5879744291305542, -1.0, 0.48886638879776, -0.5856037139892578, 0.7188941240310669, -0.6501056551933289, 0.8558641076087952, -0.6661240458488464, -0.9835873246192932, -0.4323861002922058, 0.37322214245796204, 0.7642988562583923, -0.583134651184082, -0.6679495573043823, 0.6711975336074829, -0.11889540404081345, 0.9553186297416687, 0.8793116211891174, -0.3601364493370056, -0.08327200263738632, 0.7414708733558655, -0.716362714767456, -0.7379536628723145, 0.9326720833778381))),
    OPVector(Vectors.dense(Array(-0.9124902486801147, -0.5822585225105286, -0.9898557662963867, 0.8464471697807312, 0.9321406483650208, -0.2091938853263855, 0.9207223653793335, 0.4333763122558594, -0.9483576416969299, -0.9999951720237732, -0.7879623770713806, 0.9801183938980103, 0.977097749710083, 0.8458516597747803, 0.9689813852310181, -0.7636253237724304, -0.09713872522115707, -0.7010257244110107, 0.3829590976238251, -0.19613398611545563, 0.7632167935371399, 0.9999999403953552, -0.3216153383255005, 0.4893936514854431, 0.5748499631881714, 0.9983609914779663, -0.8858421444892883, 0.9547209739685059, 0.9523528814315796, 0.7154597640037537, -0.6758488416671753, 0.2875286042690277, -0.9868399500846863, -0.3987957835197449, -0.9865517020225525, -0.9930817484855652, 0.6191356778144836, -0.794161856174469, -0.17809705436229706, 0.029405711218714714, -0.9070550799369812, 0.2874020040035248, 0.999996542930603, 0.23208755254745483, 0.5091663002967834, -0.33588576316833496, -1.0, 0.344997763633728, -0.8668491840362549, 0.9807997345924377, 0.9784290194511414, 0.970580518245697, 0.1585673689842224, 0.6590123176574707, 0.5069580674171448, -0.49162760376930237, -0.010299774818122387, 0.18413250148296356, -0.3461671769618988, -0.7098195552825928, -0.7112734913825989, 0.48459136486053467, -0.982556939125061, -0.9135647416114807, 0.9871463775634766, 0.9573682546615601, -0.23340275883674622, -0.5029971599578857, -0.31033802032470703, 0.07906980812549591, 0.9288068413734436, 0.3874102234840393, -0.4437636435031891, -0.927221953868866, 0.9289512038230896, 0.46565550565719604, -0.7544952034950256, 1.0, -0.3347429633140564, -0.9729436635971069, 0.976532518863678, 0.9544580578804016, 0.7112388014793396, -0.7741706371307373, 0.8744136095046997, -1.0, 0.6560167074203491, -0.15300600230693817, -0.9922916889190674, 0.44854629039764404, 0.8059863448143005, -0.4350389838218689, 0.9331057071685791, 0.7418062686920166, -0.8065943717956543, -0.7027645111083984, -0.44094789028167725, -0.9835132360458374, -0.36574602127075195, -0.5038186311721802, 0.21678327023983002, -0.3240010738372803, -0.5962817072868347, -0.5076926350593567, 0.39636391401290894, -0.6034124493598938, -0.4767485558986664, 0.7501687407493591, 0.5308313369750977, 0.8308504223823547, 0.6507304310798645, -0.4996706247329712, 0.5891523957252502, -0.959335207939148, 0.6997032761573792, -0.466489315032959, -0.9881011247634888, -0.7601185441017151, -0.9908823370933533, 0.6489077806472778, -0.7447920441627502, -0.4809996485710144, 0.9527793526649475, -0.7571507692337036, 0.6309919357299805, -0.3119683265686035, -0.973935604095459, -1.0, -0.8198793530464172, -0.779920220375061, -0.6289303302764893, -0.36286699771881104, -0.9696798324584961, -0.9689592719078064, 0.7476159334182739, 0.9552242755889893, 0.41967812180519104, 0.9999904036521912, -0.5142842531204224, 0.9492196440696716, -0.7204758524894714, -0.8084119558334351, 0.8289579153060913, -0.5960970520973206, 0.9380688667297363, 0.22479593753814697, -0.5934179425239563, 0.3240973949432373, -0.6613306403160095, 0.6105862855911255, -0.9026981592178345, -0.2751772701740265, -0.950721800327301, -0.9599055051803589, -0.49496662616729736, 0.961977481842041, -0.8268342018127441, -0.9889177083969116, -0.45689940452575684, -0.3333680331707001, -0.646013081073761, 0.8641698360443115, 0.8705688714981079, 0.4704434275627136, -0.674500048160553, 0.552454948425293, 0.6943706274032593, 0.7138603925704956, -0.7967106103897095, -0.38951945304870605, 0.5208693742752075, -0.44242820143699646, -0.9763960242271423, -0.9812989830970764, -0.5594546794891357, 0.6913207769393921, 0.9852278828620911, 0.8086158633232117, 0.4517330825328827, 0.918732762336731, -0.35480499267578125, 0.8791214227676392, -0.9642583131790161, 0.9804950952529907, -0.3134251534938812, 0.48224857449531555, -0.8334071636199951, 0.7823266386985779, -0.7868855595588684, 0.6091827154159546, 0.8128679394721985, -0.8955692648887634, -0.7229543924331665, -0.19107292592525482, -0.542268693447113, -0.5022060871124268, -0.9658253788948059, 0.3348447382450104, -0.41182219982147217, -0.5681091547012329, -0.2160535454750061, 0.9558275938034058, 0.9799776077270508, 0.7532914280891418, 0.6997429132461548, 0.779312789440155, -0.9222936630249023, -0.6822348237037659, 0.15578369796276093, 0.27566978335380554, 0.45180341601371765, 0.9917855262756348, -0.9291843771934509, -0.16087733209133148, -0.9467764496803284, -0.9855025410652161, -0.06295856833457947, -0.884702205657959, -0.3004284203052521, -0.755821168422699, 0.854136049747467, -0.7851243019104004, 0.8794304728507996, 0.5975145697593689, -0.9821625351905823, -0.7674455046653748, 0.531149685382843, -0.5815560221672058, 0.6189281344413757, -0.34089452028274536, 0.898970901966095, 0.989234447479248, -0.67444908618927, 0.3507041931152344, 0.9316161870956421, -0.98964923620224, -0.8347764611244202, 0.833910346031189, -0.46746137738227844, 0.8079168796539307, -0.7813984751701355, 0.991512656211853, 0.9803792238235474, 0.8834055066108704, -0.9339404702186584, -0.9351395964622498, -0.7627907395362854, -0.921901524066925, -0.25192680954933167, 0.7049176096916199, 0.9838528633117676, 0.794666051864624, 0.5652592778205872, -0.316437304019928, -0.6912213563919067, 0.9952369332313538, -0.9555758237838745, -0.9439243674278259, -0.8515334725379944, -0.5139686465263367, -0.9832807183265686, 0.9722106456756592, 0.6160960793495178, 0.8037419319152832, -0.6411909461021423, -0.8367232084274292, -0.9611026644706726, 0.8176154494285583, 0.2728842794895172, 0.9882031679153442, -0.5848803520202637, -0.9168530702590942, -0.8032220602035522, -0.9503285884857178, -0.04153778403997421, -0.30722576379776, -0.8451382517814636, 0.022852685302495956, -0.9658498764038086, 0.6331503987312317, 0.5974019765853882, 0.7005861401557922, -0.978108286857605, 0.9992042779922485, 1.0, 0.9636671543121338, 0.89503014087677, 0.9236666560173035, -0.9999986290931702, -0.8257517218589783, 0.9999990463256836, -0.9987579584121704, -1.0, -0.9290680289268494, -0.7552163600921631, 0.41980263590812683, -1.0, -0.2826172411441803, -0.14259301126003265, -0.9076869487762451, 0.8862740397453308, 0.9559165835380554, 0.9946975708007812, -1.0, 0.791987955570221, 0.9342630505561829, -0.7725147008895874, 0.9912477731704712, -0.5481800436973572, 0.9662236571311951, 0.8596358299255371, 0.5972326397895813, -0.29239198565483093, 0.6657724976539612, -0.9935241341590881, -0.8803303241729736, -0.8949299454689026, -0.9501421451568604, 0.9999521970748901, 0.2842711806297302, -0.8399420380592346, -0.8831145763397217, 0.7344481945037842, -0.19675494730472565, 0.16091260313987732, -0.9768313765525818, -0.43052059412002563, 0.8204983472824097, 0.8997607827186584, 0.2584170997142792, 0.4834935963153839, -0.5617560148239136, 0.4164508581161499, 0.5935564637184143, 0.46189913153648376, 0.8021942973136902, -0.9654045104980469, -0.48495998978614807, -0.6062420010566711, 0.2406790852546692, -0.8950490951538086, -0.9747811555862427, 0.9614906311035156, -0.6371176242828369, 0.9509202837944031, 1.0, 0.6829662322998047, -0.8573758602142334, 0.9020235538482666, 0.4086802303791046, -0.7993922829627991, 1.0, 0.9241241216659546, -0.9715315103530884, -0.6817447543144226, 0.817097008228302, -0.6967878937721252, -0.7820203304290771, 0.9997626543045044, -0.37489819526672363, -0.93380206823349, -0.8400110006332397, 0.9778357744216919, -0.9806191921234131, 0.9998061656951904, -0.8826718926429749, -0.9733995199203491, 0.9739762544631958, 0.9517772197723389, -0.8546589016914368, -0.7380899786949158, 0.34666696190834045, -0.8984371423721313, 0.48839274048805237, -0.9347822666168213, 0.7931649684906006, 0.5109204053878784, -0.03549530357122421, 0.8793215155601501, -0.5766903162002563, -0.7054321765899658, 0.3435198962688446, -0.8211202621459961, -0.5131065249443054, 0.9935965538024902, 0.6760320067405701, -0.2786124050617218, -5.891910404898226E-4, -0.44675132632255554, -0.7691044807434082, -0.9765040278434753, 0.7497661709785461, 1.0, -0.607046902179718, 0.9419636726379395, -0.6645175814628601, -0.15858891606330872, 0.24707846343517303, 0.6734398007392883, 0.7642862200737, -0.45554566383361816, -0.9118509888648987, 0.9475504159927368, -0.970798909664154, -0.9860809445381165, 0.7824862003326416, 0.4121874272823334, -0.42533788084983826, 0.9999998807907104, 0.7831693291664124, 0.3097483217716217, 0.6959971189498901, 0.9981711506843567, 0.08146869391202927, 0.6102398633956909, 0.9863820672035217, 0.9759995937347412, -0.4072580337524414, 0.7042560577392578, 0.7648395895957947, -0.9845384955406189, -0.3719462454319, -0.7473865747451782, 0.19525693356990814, -0.9425356388092041, -0.008515708148479462, -0.9511376619338989, 0.9708553552627563, 0.9869042634963989, 0.555461585521698, 0.43860068917274475, 0.8317052125930786, 1.0, -0.9095810651779175, 0.664113461971283, 0.37569254636764526, 0.7221931219100952, -0.9999961853027344, -0.8581874966621399, -0.4975602626800537, -0.09665881097316742, -0.9761216044425964, -0.5583299398422241, 0.4678269624710083, -0.957855761051178, 0.9682227373123169, 0.885125458240509, -0.9912838339805603, -0.9898898005485535, -0.5311659574508667, 0.7936042547225952, 0.26606130599975586, -0.9989801645278931, -0.8316351771354675, -0.5452082753181458, 0.8605219125747681, -0.43487557768821716, -0.9423600435256958, -0.6574853658676147, -0.5322628021240234, 0.6092966198921204, -0.3756702244281769, 0.7162792086601257, 0.9735221862792969, 0.47406503558158875, -0.9334881901741028, -0.7281399369239807, -0.23393508791923523, -0.8245875835418701, 0.8158223628997803, -0.7765483856201172, -0.9876886606216431, -0.40261825919151306, 1.0, -0.6272340416908264, 0.9832149147987366, 0.7480024099349976, 0.6348006725311279, -0.35507088899612427, 0.29163479804992676, 0.9926059246063232, 0.40816155076026917, -0.9533937573432922, -0.9771551489830017, 0.251087486743927, -0.5916203856468201, 0.641410231590271, 0.9075611233711243, 0.9378225803375244, 0.854650616645813, 0.9569454789161682, 0.2637079358100891, -0.1857580840587616, -0.014924111776053905, 0.9995182156562805, -0.10239536315202713, -0.30008310079574585, -0.4689793288707733, -0.1979486495256424, -0.441646009683609, 0.15911956131458282, 1.0, 0.4563117027282715, 0.8589262962341309, -0.9850248694419861, -0.9751089215278625, -0.9113824367523193, 1.0, 0.8741071820259094, -0.7248361706733704, 0.7775505781173706, 0.8020017147064209, -0.13068686425685883, 0.7227038145065308, -0.34835636615753174, -0.4605422616004944, 0.2630296051502228, 0.29610568284988403, 0.9492440223693848, -0.7660416960716248, -0.9712028503417969, -0.6231778264045715, 0.6174799799919128, -0.9755278825759888, 0.9999996423721313, -0.7073011994361877, -0.39485177397727966, -0.541361391544342, -0.4132392704486847, -0.7529093623161316, 0.1762184351682663, -0.9796195030212402, -0.3280527889728546, 0.3766232132911682, 0.9532275199890137, 0.32994192838668823, -0.6963586807250977, -0.9058724641799927, 0.9567632675170898, 0.9103637337684631, -0.9867548942565918, -0.9405925869941711, 0.9570761322975159, -0.9871115684509277, 0.7834097743034363, 1.0, 0.39752355217933655, 0.5234731435775757, 0.3232094347476959, -0.4717613458633423, 0.585321307182312, -0.7560399770736694, 0.7738968729972839, -0.9640697240829468, -0.5726373195648193, -0.3542391359806061, 0.37801313400268555, -0.22341977059841156, -0.4893322288990021, 0.6893085241317749, 0.4537900984287262, -0.6982716917991638, -0.755009651184082, -0.26547256112098694, 0.5830590128898621, 0.9288013577461243, -0.4142801761627197, -0.3055828809738159, 0.12514406442642212, -0.13650421798229218, -0.9656180143356323, -0.4171315133571625, -0.5751986503601074, -1.0, 0.7734172344207764, -1.0, 0.8717236518859863, 0.6935024261474609, -0.36281388998031616, 0.865341067314148, 0.8231115937232971, 0.8688036203384399, -0.7462577819824219, -0.9782180190086365, -0.07821053266525269, 0.8283101320266724, -0.46432653069496155, -0.6425426602363586, -0.7412632703781128, 0.5272682905197144, -0.224508598446846, 0.40547358989715576, -0.7188090682029724, 0.7645013332366943, -0.38330644369125366, 1.0, 0.3380715250968933, -0.6903063654899597, -0.9846788644790649, 0.34932610392570496, -0.32228976488113403, 1.0, -0.8019270896911621, -0.9311280250549316, 0.5918017625808716, -0.8500744700431824, -0.8786128759384155, 0.4673911929130554, 0.016841957345604897, -0.8632163405418396, -0.9926803112030029, 0.9664514064788818, 0.787948489189148, -0.7730278968811035, 0.7336751222610474, -0.49019894003868103, -0.7285524606704712, 0.01647586189210415, 0.9715210795402527, 0.9870516061782837, 0.8679680824279785, 0.8496224880218506, -0.5292475819587708, -0.5995485782623291, 0.9754376411437988, 0.14709147810935974, -0.007803735323250294, 0.2181490808725357, 1.0, 0.4746270179748535, -0.9232636094093323, -0.3738497197628021, -0.9693703055381775, -0.3638461232185364, -0.9281657338142395, 0.40998589992523193, 0.45793265104293823, 0.9292412400245667, -0.48142802715301514, 0.9482362866401672, -0.9700932502746582, 0.12757791578769684, -0.7479067444801331, -0.7971987128257751, 0.43647995591163635, -0.9360325336456299, -0.9773904085159302, -0.9799891710281372, 0.8045201301574707, -0.5494681000709534, -0.19767023622989655, 0.3246542513370514, 0.05666648969054222, 0.6178258657455444, 0.6545829176902771, -1.0, 0.9408096671104431, 0.5217208862304688, 0.988284170627594, 0.9512864947319031, 0.9065241813659668, 0.6764164566993713, 0.3840748965740204, -0.9761964678764343, -0.9862042665481567, -0.46588242053985596, -0.2237337976694107, 0.7333628535270691, 0.7581509947776794, 0.9177325367927551, 0.5167476534843445, -0.5516214966773987, -0.7231185436248779, -0.9212215542793274, -0.9218459725379944, -0.9925684928894043, 0.57787024974823, -0.8339836001396179, -0.9209933876991272, 0.9571356773376465, 0.3988119065761566, -0.23960965871810913, -0.6214758157730103, -0.96832275390625, 0.9440550804138184, 0.8555119037628174, 0.16420875489711761, 0.2022220492362976, 0.3249674439430237, 0.8779358863830566, 0.9227158427238464, 0.9658432602882385, -0.9658228158950806, 0.797809898853302, -0.875795304775238, 0.7632598280906677, 0.8858934044837952, -0.9510661363601685, 0.2584209740161896, 0.7541425824165344, -0.5752070546150208, 0.2738051116466522, -0.3721840977668762, -0.9742290377616882, 0.6690986156463623, -0.3094942569732666, 0.6731207370758057, -0.6310064196586609, -0.11624834686517715, -0.5405431985855103, -0.23873841762542725, -0.5582141876220703, -0.8148447871208191, 0.7745575904846191, 0.38999298214912415, 0.897004246711731, 0.9689075946807861, -0.09537925571203232, -0.6928563117980957, -0.2362758368253708, -0.9390239715576172, -0.9104374647140503, 0.9300318360328674, -0.201883003115654, -0.7439862489700317, 0.9126617312431335, 0.14370106160640717, 0.9522445201873779, 0.6592445373535156, -0.44205817580223083, -0.49263155460357666, -0.6360775232315063, 0.9040178656578064, -0.6327981948852539, -0.7855622172355652, -0.7482285499572754, 0.8154376149177551, 0.4662497043609619, 0.9999997615814209, -0.9492062330245972, -0.9862081408500671, -0.5847660303115845, -0.5507838726043701, 0.5938658714294434, -0.7037017941474915, -1.0, 0.4222653806209564, -0.8543863296508789, 0.9416859745979309, -0.9199944138526917, 0.9762141704559326, -0.8294714093208313, -0.9870240092277527, -0.563434898853302, 0.8285048007965088, 0.9487935304641724, -0.5859919786453247, -0.826934814453125, 0.7438055872917175, -0.5046728849411011, 0.9977472424507141, 0.8263589143753052, -0.40621548891067505, -0.3737298846244812, 0.788233757019043, -0.9297775626182556, -0.7988225221633911, 0.9429836869239807))),
    OPVector.empty
  )
  // scalastyle:on

  Spec[BERTModelResourceLoader] should "create the BERT model" in {
    val bertModel = bertLoader.model
    bertModel.config shouldBe BERTModelConfig(
      doLowerCase = true,
      inputIds = "input_ids:0",
      inputMask = "input_mask:0",
      segmentIds = "segment_ids:0",
      pooledOutput = "module_apply_tokens/bert/pooler/dense/Tanh:0",
      sequenceOutput = "module_apply_tokens/bert/encoder/Reshape_13:0",
      maxSequenceLength = 128
    )
    bertModel.modelBundle should not be null
    bertModel.tokenizer should not be null
  }

  it should "produce a model that computes single sentence embedding correctly" in {
    val bertModel = bertLoader.model

    val embedding = bertModel("hello world")
    embedding.length shouldBe 768
    embedding.exists(_ != 0f) shouldBe true

    embedding shouldBe bertModel("hello world")
    val _ = bertModel("aaaa")
    embedding shouldBe bertModel("hello world")
  }

  it should "produce a model that computes multi-sentence embeddings" in {
    val bertModel = bertLoader.model

    val embeddings = bertModel(Array("hello world", "OK OK", ""))
    embeddings.foreach { embedding =>
      embedding.length shouldBe 768
      embedding.exists(_ != 0f) shouldBe true
    }
  }

}
